<div id="filter-grid-container">
    <select name="" id="user-dropdown">
        <option value=""></option>
        <?php foreach ($this->getUsers() as $_user): ?>
            <option value="<?php echo $_user->getUserId(); ?>">
                <?php echo $_user->getFirstname() . ' ' . $_user->getLastname(); ?>
            </option>
        <?php endforeach; ?>
    </select>
    <button id="load-btn">load</button>
    <div id="report-table-container">
    </div>
</div>

<script>
    document.observe("dom:loaded", function () {
        var loadUrl = '<?php echo $this->getUrl("*/*/load"); ?>';
        var reportGrid = new FilterReportGrid('report-table-container', 'user-dropdown', 'load-btn', loadUrl);
    })
</script>

<style>
    .report-table {
        width: 100%;
        border-collapse: collapse;
    }

    .report-table th,
    .report-table td {
        border: 1px solid #ddd;
        padding: 8px;
    }

    .report-table th {
        background-color: #f2f2f2;
        text-align: left;
    }
</style>
<script>
    var userIsActive = false;
    var inactivityTimer;

    function resetActivity() {
        userIsActive = true;
        clearTimeout(inactivityTimer);
        startInactivityTimer();
    }

    function startInactivityTimer() {
        inactivityTimer = setTimeout(function () {
            if (userIsActive == false) {
                var confirmation = confirm("No activity done from the last 5 minutes. Are you available?");
                if (confirmation) {
                    resetActivity();
                } else {
                    var url = "<?php echo Mage::getUrl('*/*/logout') ?>";
                    new Ajax.Request(url, {
                        parameters: {},
                        method: 'post',
                        onFailure: function (e) {
                            console.log(e);
                        },
                        onSuccess: function (response) {
                            window.location.href = "<?php echo Mage::getUrl('adminhtml/index/login'); ?>";
                        }
                    })
                }
            } else {
                userIsActive = false; 
                startInactivityTimer();
            }
        }, 5 * 60 * 1000);
    }

    document.observe('mousemove', resetActivity);
    document.observe('keypress', resetActivity);

    function userIsAvailable() {
        resetActivity();
    }

    startInactivityTimer();

    // Event.observe($('load-btn'), 'click', function(){
    //     var userId = $F('user-dropdown');
    //     if (userId) {
    //         new Ajax.Request('<?php echo $this->getUrl("*/*/load"); ?>', {
    //             parameters: { 'user_id': userId },
    //             method: 'post',
    //             onFailure: function (e) {
    //                 console.log(e);
    //             },
    //             onSuccess: function (response) {
    //                 try {
    //                     var data = JSON.parse(response.responseText);
    //                     updateContainer(data);
    //                 } catch (e) {
    //                     $(this.containerId).update("");
    //                 }
    //                 $(this.containerId).update("");
    //             }.bind(this)
    //         })
    //     } else {
    //         console.log("nothing");
    //     }
    // })
    function updateContainer(data){
        var container = $('report-table-container');
        // container.update("dhruvik"); 
        // console.log(container);
        var heading = new Element('h1');
        // heading.update($F(this.dropdownId));
        container.insert(heading);
        if (data && data.length > 0) {
            var table = new Element('table', { 'class': 'report-table' });

            var thead = new Element('thead');
            var headerRow = new Element('tr');
            ['ID', 'Report Type', 'Filter Data'].forEach(function (header) {
                headerRow.insert(new Element('th').update(header));
            });
            thead.insert(headerRow);
            table.insert(thead);

            var tbody = new Element('tbody');
            data.forEach(function (item) {
                var row = new Element('tr');
                var reportType = (item.report_type == 1) ? 'Product' : 'Customer';
                row.insert(new Element('td').update(item.id));
                row.insert(new Element('td').update(reportType));
                row.insert(new Element('td').update(item.filter_data));
                tbody.insert(row);
            });
            table.insert(tbody);
            container.insert(table);
        } else {
            container.update("No data found");
        }
    }
</script>